!function(){"use strict";const e="webhooksDb";let t;const n=n=>new Promise(((o,a)=>{const s=t.transaction([e],"readwrite"),r=s.objectStore(e);n.forEach((e=>{r.put(e)})),s.oncomplete=()=>o(),s.onerror=e=>a(e.target.error)}));let o=[],a=null,s=null;const r=document.getElementById("webhook-list"),c=document.getElementById("request-list"),l=document.getElementById("request-headers"),i=document.getElementById("request-body-raw"),d=document.getElementById("waiting-for-events"),u=document.getElementById("requests-container"),m=document.getElementById("copy-popup"),p=document.getElementById("curl-example"),g=document.getElementById("powershell-example"),y=document.getElementById("copy-example"),b=document.getElementById("copy-active-webhook-url"),h=document.getElementById("active-webhook-url"),x=document.getElementById("copy-body"),w=e=>{a=e},v=e=>{s=e},E=async()=>{o=await new Promise(((n,o)=>{const a=t.transaction([e],"readonly").objectStore(e).getAll();a.onsuccess=()=>n(a.result),a.onerror=e=>o(e.target.error)})),0===o.length?await f():a&&await a.invoke("CreateWebhooksAsync",o.map((e=>e.slug))),S(o),$(0,o)},f=async()=>{const e=k(),t={url:`${s}/webhooks/${e}`,slug:e,requests:[]};if(a)try{await a.invoke("CreateWebhooksAsync",[e]),o.push(t),await n(o),S(o),$(o.length-1,o)}catch(e){console.error("Failed to create webhook on server:",e),alert("Failed to create webhook. Please try again.")}else console.error("SignalR connection not available"),alert("Cannot create webhook. Connection to server not available.")},k=()=>{const e=["red","blue","green","yellow","purple","orange","pink","grey","white","black","brown","cyan","magenta","lime","teal","indigo","violet","gold","silver","bronze","maroon","navy","olive","aqua","turquoise","lavender"],t=["dog","hawk","tiger","wolf","panther","dragon","falcon","panda","cat","bear","fox","mouse","rat","bird","pig","chicken","duck","elephant","lion","giraffe","zebra","koala","rhino","hippo","monkey","gorilla","penguin","dolphin","whale","shark","octopus","eagle","owl","bat","squirrel","rabbit","deer","moose","bison","coyote","leopard","jaguar"],n=Math.floor(1e6*Math.random());return`${e[Math.floor(Math.random()*e.length)]}-${t[Math.floor(Math.random()*t.length)]}-${n.toString().padStart(6,"0")}`},L=async n=>{o=o.filter((e=>e.slug!==n)),await(n=>new Promise(((o,a)=>{const s=t.transaction([e],"readwrite").objectStore(e).delete(n);s.onsuccess=()=>o(),s.onerror=e=>a(e.target.error)})))(n),S(o),o.length>0?$(0,o):I()},S=e=>{r.innerHTML="",e.forEach(((t,n)=>{const o=document.createElement("li");o.innerHTML=`\n            <span class="webhook-url">${t.slug}</span>\n            <button class="remove-btn" data-url="${t.url}" aria-label="Remove webhook">&times;</button>\n        `,o.onclick=()=>$(n,e),o.querySelector(".remove-btn").onclick=e=>{e.stopPropagation(),L(t.slug)},r.appendChild(o)}))},$=(e,t)=>{const n=t[e];P(n.url),h.textContent=n.url,0===n.requests.length?I():(q(n),C(n.requests[n.requests.length-1]))},I=()=>{d.style.display="flex",u.style.display="none"},q=e=>{d.style.display="none",u.style.display="flex",c.innerHTML="",e.requests.forEach(((e,t)=>{const n=document.createElement("li"),o=new Date(e.timestamp),a=o.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),s=o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});n.innerHTML=`\n            <span class="request-method ${e.method.toLowerCase()}">${e.method}</span>\n            <span class="request-timestamp">\n                <span class="request-date">${a}</span>\n                <span class="request-time">${s}</span>\n            </span>\n        `,n.onclick=()=>C(e),c.appendChild(n)}))},C=e=>{O(e.headers);const t=e.body,n=(((e,t)=>{const n=t.toLowerCase(),o=Object.keys(e).find((e=>e.toLowerCase()===n));return o?e[o]:null})(e.headers,"content-type")||"").toLowerCase(),o=document.getElementById("request-body-raw"),a=document.getElementById("request-body-formatted"),s=document.querySelector('.body-tabs .tab-btn[data-tab="raw"]'),r=document.querySelector('.body-tabs .tab-btn[data-tab="formatted"]');o.textContent=t;let c="",l=!0,i="Formatted";if(/^application\/json\b/.test(n))try{const e=JSON.parse(t);c=N(e),i="JSON"}catch(e){c="<p>Invalid JSON</p>",i="Invalid JSON"}else/^(application|text)\/xml\b/.test(n)?(c=T(t),i="XML"):/^application\/x-www-form-urlencoded\b/.test(n)?(c=B(t),i="Form Data"):/^text\/plain\b/.test(n)?(c=`<pre>${M(t)}</pre>`,i="Plain Text"):l=!1;a.innerHTML=c,r.textContent=i,r.style.display=l?"inline-block":"none";const d=r.classList.contains("active");!l&&d&&s.click();const u=document.querySelectorAll(".body-tabs .tab-btn"),m=document.querySelectorAll(".body-tab-content .code-example");u.forEach((e=>{e.addEventListener("click",(()=>{u.forEach((e=>e.classList.remove("active"))),m.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),document.querySelector(`.body-tab-content .code-example#request-body-${e.dataset.tab}`).classList.add("active")}))}))},T=e=>{const t=(new DOMParser).parseFromString(e,"text/xml");new XMLSerializer;let n="",o=0;const a=e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e.nodeName,s=Array.from(e.attributes).map((e=>`<span class="xml-attribute">${e.name}</span>="<span class="xml-attribute-value">${e.value}</span>"`)).join(" ");n+="  ".repeat(o),n+=`&lt;<span class="xml-tag">${t}</span>${s?" "+s:""}>`,1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE?(n+=`<span class="xml-text">${e.textContent}</span>`,n+=`&lt;/<span class="xml-tag">${t}</span>&gt;\n`):(n+="\n",o++,Array.from(e.childNodes).forEach(a),o--,n+="  ".repeat(o),n+=`&lt;/<span class="xml-tag">${t}</span>&gt;\n`)}else e.nodeType===Node.TEXT_NODE&&e.textContent.trim()&&(n+="  ".repeat(o),n+=`<span class="xml-text">${e.textContent.trim()}</span>\n`)};return a(t.documentElement),`<div class="xml-viewer">${n}</div>`},B=e=>{const t=new URLSearchParams(e);let n='<div class="form-data-viewer">';for(const[e,o]of t)n+='<div class="form-data-item">',n+=`<span class="form-data-key">${M(e)}</span>: `,n+=`<span class="form-data-value">${M(o)}</span>`,n+="</div>";return n+="</div>",n},M=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),N=e=>'<div class="json-viewer">'+JSON.stringify(e,null,2).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(e=>{let t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),`<span class="${t}">${e}</span>`}))+"</div>",O=e=>{l.innerHTML=`\n        <thead>\n            <tr>\n                <th>Header</th>\n                <th>Value</th>\n            </tr>\n        </thead>\n        <tbody>\n            ${Object.entries(e).map((([e,t])=>`\n                    <tr>\n                        <td><span class="header-key">${R(e)}</span></td>\n                        <td><span class="header-value">${R(t)}</span></td>\n                    </tr>\n                `)).join("")}\n        </tbody>\n    `},R=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),D=e=>{navigator.clipboard.writeText(e).then((()=>{H()})).catch((e=>{console.error("Failed to copy: ",e)}))},H=()=>{m.classList.add("show"),setTimeout((()=>{m.classList.remove("show")}),2e3)},P=e=>{const t=JSON.stringify({name:"Test event",data:{id:1,name:"Tester McTestFace",by:"Webhook Tester",at:(new Date).toISOString()},user:{email:"tester@example.com"},ts:Date.now()});p.textContent=`curl ${e} -X POST -H "Content-Type: application/json" -d '${t}'`,g.textContent=`$body = '${t}'\nInvoke-WebRequest -Uri "${e}" -Method POST -Body $body -ContentType "application/json"`},j=document.querySelectorAll(".tabs .tab-btn"),A=document.querySelectorAll(".tab-content .code-example");j.forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.tab;j.forEach((e=>e.classList.remove("active"))),A.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),document.getElementById(`${t}-example`).classList.add("active")}))})),y.addEventListener("click",(()=>{const e=document.querySelector(".tabs .tab-btn.active").dataset.tab,t=document.getElementById(`${e}-example`).textContent;D(t)})),b.addEventListener("click",(()=>{D(h.textContent)})),x.addEventListener("click",(()=>{D(i.textContent)}));const F=()=>{let e=localStorage.getItem("clientId");return e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),localStorage.setItem("clientId",e)),e},U=async e=>{try{await e.start(),console.log("Connected to SignalR")}catch(t){console.error("SignalR Connection Error: ",t),setTimeout((()=>U(e)),5e3)}},J=e=>{const t=document.getElementById("connection-status-popup"),n=document.getElementById("connection-status-text"),o=document.getElementById("connection-status-icon");if(t&&n&&o){switch(n.textContent=e,t.classList.remove("connection-status-connected","connection-status-reconnecting","connection-status-disconnected"),e){case"Connected":t.classList.add("connection-status-connected");break;case"Reconnecting...":t.classList.add("connection-status-reconnecting");break;case"Disconnected":t.classList.add("connection-status-disconnected")}t.classList.add("show"),setTimeout((()=>{t.classList.remove("show")}),5e3)}};(async()=>{await new Promise(((n,o)=>{const a=indexedDB.open("WebhookTesterDb",1);a.onerror=e=>o("IndexedDB error: "+e.target.error),a.onsuccess=e=>{t=e.target.result,n(t)},a.onupgradeneeded=n=>{t=n.target.result,t.createObjectStore(e,{keyPath:"slug"})}}));const a=F(),s=(e=>(new signalR.HubConnectionBuilder).withUrl(`/hub?clientId=${e}`).withAutomaticReconnect([0,2e3,5e3,1e4,15e3,3e4,null]).configureLogging(signalR.LogLevel.Information).withHubProtocol(new signalR.protocols.msgpack.MessagePackHubProtocol).build())(a);s.onreconnecting((()=>J("Reconnecting..."))),s.onreconnected((()=>J("Connected"))),s.onclose((async e=>{J("Disconnected"),await U(s),w(s),J("Connected")})),s.on("ReceiveBaseUrl",(async e=>{console.log("Received base URL:",e),v(e),await E(),(()=>{const e=document.getElementById("loading-overlay");e&&(e.style.display="none")})()})),s.on("NewRequest",(e=>{console.log("New Webhook Request:",e);const t={id:e.Id,timestamp:new Date(e.Timestamp).toISOString(),method:e.HttpMethod,headers:e.HttpHeaders,body:e.HttpBody};((e,t)=>{const a=o.find((t=>t.slug===e));a&&(a.requests.push(t),n(o),$(o.indexOf(a),o))})(e.Slug,t)})),await U(s),console.log("Connected to SignalR with clientId:",a),w(s),J("Connected");document.getElementById("add-webhook").addEventListener("click",f)})().catch((e=>console.error("Initialization error: ",e)))}();
//# sourceMappingURL=bundle.min.js.map
